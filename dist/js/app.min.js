/*! app 2017-02-07 */
function initMap(){var a=SETTINGS;map=new google.maps.Map(document.getElementById("map"),{center:a,zoom:13}),map.setOptions({draggable:!1,scrollwheel:!1,zoomControl:!1});var b={location:a,radius:"5000",types:vm.placeTypes()};service=new google.maps.places.PlacesService(map),service.nearbySearch(b,processResults),infoWindow=new google.maps.InfoWindow({content:"Loading..."}),google.maps.event.addListener(infoWindow,"closeclick",function(){toggleBounce(vm.currentMarker)})}function processResults(a,b){b==google.maps.places.PlacesServiceStatus.OK&&a.forEach(function(a){vm.addPlace(a)})}function mapsAPIFail(){alert("Google Maps API failed to load")}function toggleBounce(a){null!==a.getAnimation()?a.setAnimation(null):a.setAnimation(google.maps.Animation.BOUNCE)}function toggleInfoWindow(a){infoWindow.close(),infoWindow.open(map,a.marker)}function fillContentNYT(a){var b=a.response.docs;return b.length>0?(NYTcontentString="<ul>",b.forEach(function(a){NYTcontentString+='<li><a href="'+a.web_url+'"target="_blank">'+a.headline.main+"</a></li>"}),NYTcontentString+="</ul>"):NYTcontentString="No NYT articles available",NYTcontentString}function fillContentFsqr(a){return FsqrContentString=a.length>0?a[0].name+"<br>ph: "+a[0].contact.formattedPhone+"<br><br>":"No Foursqare data available<br>"}function nytRequest(a){var b="https://api.nytimes.com/svc/search/v2/articlesearch.json?q=",c="12b1ea26e35c4b7c9f124169f2ae3013",d=b+a.name+" Hopewell, NJ&api-key="+c;return $.getJSON(d,function(b){a.NYTContent=fillContentNYT(b)}).fail(function(){alert("ajax request failed")})}function fsqrRequest(a){var b="https://api.foursquare.com/v2/venues/search?ll=",c="FV0ODMT135QKDMWNIYOLAZHGEIFBZCHE5S54ZEKBBQWV5ZSK",d="4P2FWJ20X4RBAK1U4B1QEX1EKGYASEVWL1BKMDFD2TJECKF2",e=20170101,f=b+a.lat+","+a.lng+"&query="+a.name+"&intent=match&client_id="+c+"&client_secret="+d+"&v="+e;return $.getJSON(f,function(b){a.FoursquareContent=fillContentFsqr(b.response.venues)}).fail(function(){alert("Foursquare request failed")})}var SETTINGS={lat:40.3893,lng:-74.7618},Place=function(a){var b=this;b.name=a.name,b.placeTypes=a.types,b.lat=a.geometry.location.lat(),b.lng=a.geometry.location.lng(),b.NYTContent="",b.FoursquareContent="",b.visible=ko.observable(!0),b.marker=new google.maps.Marker({position:a.geometry.location,title:b.name}),b.marker.setAnimation(null),b.marker.setMap(map),b.marker.addListener("click",function(){null!==vm.currentMarker&&null!==vm.currentMarker.getAnimation()&&toggleBounce(vm.currentMarker),vm.currentMarker=b.marker,map.panTo({lat:b.lat,lng:b.lng});var a=fsqrRequest(b),c=nytRequest(b);$.when(a,c).done(function(){infoWindow.setContent(b.FoursquareContent+b.NYTContent)}),toggleInfoWindow(b),toggleBounce(b.marker)})},ViewModel=function(){var a=this;a.menuState=ko.observable("overlayOpen"),a.togglemenu=function(){"overlay"==a.menuState()?a.menuState("overlayOpen"):a.menuState("overlay")},a.places=ko.observableArray(),a.placeTypes=ko.observableArray(["bakery","cafe","library","lodging","meal_takeaway","park","restaurant"]),a.addPlace=function(b){a.places.push(new Place(b))},a.setVisible=function(b){for(var c=0,d=a.places(),e=d.length;c<e;c++){var f=d[c],g=f.placeTypes.includes(b)||"undefined"==typeof b;f.visible(g),f.marker.setVisible(g)}},a.selectedType=ko.observable(),a.selectedType.subscribe(function(b){a.setVisible(b)}),a.currentMarker=null,a.getPlaceDetail=function(b){google.maps.event.trigger(b.marker,"click"),a.togglemenu(),a.currentMarker=b.marker}},vm=new ViewModel;ko.applyBindings(vm);var map,service,infoWindow,NYTcontentString="",FsqrContentString="";