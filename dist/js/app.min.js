/*! app 2017-02-06 */
function initMap(){var a={lat:40.3893,lng:-74.7618};map=new google.maps.Map(document.getElementById("map"),{center:a,zoom:13}),map.setOptions({draggable:!1,scrollwheel:!1,zoomControl:!1});var b={location:a,radius:"5000",types:vm.placeTypes()};service=new google.maps.places.PlacesService(map),service.nearbySearch(b,processResults)}function processResults(a,b){if(b==google.maps.places.PlacesServiceStatus.OK)for(var c=0;c<a.length;c++){var d=createMarker(a[c]);createInfoWindow(d),vm.addPlace(a[c],d)}}function createMarker(a){var b=new google.maps.Marker({position:a.geometry.location,title:a.name});return b.setAnimation(null),b.setMap(map),b}function createInfoWindow(a){a.infowindow=new google.maps.InfoWindow({})}function toggleBounce(a){null!==a.getAnimation()?a.setAnimation(null):a.setAnimation(google.maps.Animation.BOUNCE)}function toggleInfoWindow(a){var b=a.marker.infowindow.getMap();null!==b&&"undefined"!=typeof b?a.marker.infowindow.close():a.marker.infowindow.open(map,a.marker)}function fillContentNYT(a){var b=a.response.docs;if(b.length>0){NYTcontentString="<ul>";for(var c=0;c<b.length;c++){var d=b[c];NYTcontentString+='<li><a href="'+d.web_url+'">'+d.headline.main+"</a></li>"}NYTcontentString+="</ul>"}else NYTcontentString="No NYT articles available";return NYTcontentString}function fillContentFsqr(a){return FsqrContentString=a.length>0?a[0].name+"<br>ph: "+a[0].contact.formattedPhone+"<br><br>":"No Foursqare data available<br>"}function nytRequest(a){var b="https://api.nytimes.com/svc/search/v2/articlesearch.json?q=",c="12b1ea26e35c4b7c9f124169f2ae3013",d=b+a.name+" Hopewell, NJ&api-key="+c;asynch1=$.getJSON(d,function(b){a.NYTContent=fillContentNYT(b)}).fail(function(){alert("ajax request failed")})}function fsqrRequest(a){var b="https://api.foursquare.com/v2/venues/search?ll=",c="FV0ODMT135QKDMWNIYOLAZHGEIFBZCHE5S54ZEKBBQWV5ZSK",d="4P2FWJ20X4RBAK1U4B1QEX1EKGYASEVWL1BKMDFD2TJECKF2",e=20170101,f=b+a.lat+","+a.lng+"&query="+a.name+"&intent=match&client_id="+c+"&client_secret="+d+"&v="+e;asynch2=$.getJSON(f,function(b){a.FoursquareContent=fillContentFsqr(b.response.venues)}).fail(function(){alert("Foursquare request failed")})}var Place=function(a,b){var c=this;c.name=a.name,c.placeTypes=a.types,c.lat=a.geometry.location.lat(),c.lng=a.geometry.location.lng(),c.marker=b,c.NYTContent="",c.FoursquareContent="",c.visible=ko.observable(!0)},ViewModel=function(){var a=this;a.togglemenu=function(){$("#placesList").width()>0?$("#placesList").css("width","0px"):$("#placesList").css("width","100%")},a.places=ko.observableArray(),a.placeTypes=ko.observableArray(["bakery","cafe","library","lodging","meal_takeaway","park","restaurant"]),a.addPlace=function(b,c){a.places.push(new Place(b,c))},a.setVisible=function(b){for(var c=0,d=a.places();c<d.length;c++){var e=d[c];e.placeTypes.includes(b)||"undefined"==typeof b?(e.visible(!0),e.marker.setMap(map)):(e.visible(!1),e.marker.setMap(null))}},a.selectedType=ko.observable(),a.selectedType.subscribe(function(b){a.setVisible(b)}),a.currentPlaceObj=null,a.getPlaceDetail=function(b){null!==a.currentPlaceObj&&(toggleBounce(a.currentPlaceObj.marker),toggleInfoWindow(a.currentPlaceObj)),a.currentPlaceObj=b,map.panTo({lat:b.lat,lng:b.lng}),fsqrRequest(b),nytRequest(b),$.when(asynch1,asynch2).done(function(){a.currentPlaceObj.marker.infowindow.setContent(a.currentPlaceObj.FoursquareContent+a.currentPlaceObj.NYTContent)}),toggleBounce(b.marker),toggleInfoWindow(b),a.togglemenu()}},vm=new ViewModel;ko.applyBindings(vm);var map,service,NYTcontentString="",FsqrContentString="",asynch1,asynch2;